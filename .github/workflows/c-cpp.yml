name: C/C++ CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-22.04 

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      
    # --- 1. Install Dependencies (Fix: Removed nlohmann-json-dev) ---
    - name: Install System Dependencies
      run: |
        sudo apt-get update
        # Install CMake and build tools
        sudo apt-get install -y build-essential cmake
        # Install libcurl development files, which is necessary for the 'cpr' library
        sudo apt-get install -y libcurl4-openssl-dev

    # --- 2. Configure (Out-of-Source Build) ---
    - name: Configure CMake
      run: |
        # Create a build directory
        mkdir build
        # Run CMake from within the build directory
        cmake -S . -B build

    # --- 3. Build ---
    - name: Compile Project
      # Compile using all available CPU cores for speed
      run: cmake --build build --config Release -- -j$(nproc)

    # --- 4. Test (Placeholder for CTest) ---
    - name: Run Tests (if applicable)
      # This step requires you to define tests in CMake using 'add_test()'
      run: ctest --test-dir build --output-on-failure || true

    # --- 5. Install and Upload Artifacts ---
    - name: Install Final Executable
      # Install the compiled output into a temporary directory
      run: cmake --install build --prefix ./install_dir
    
    - name: Upload Executable Artifact
      uses: actions/upload-artifact@v4
      with:
        name: ip-tracker-linux-executable
        path: install_dir
        if-no-files-found: error
        
